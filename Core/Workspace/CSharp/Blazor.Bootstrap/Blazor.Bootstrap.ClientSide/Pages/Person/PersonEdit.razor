@page "/person/edit/{id}"
@attribute [Authorize]
@inject IDatabase Database
@inject Workspace Workspace
@inject IUriHelper UriHelper

@if (person == null)
{
    <p><em>Loading...</em></p>
}
else
{ <EditForm Model="@person" OnValidSubmit="@HandleValidSubmit">
        <AllorsValidator />
        <ValidationSummary />
        <div class="container">
            <div class="row">
                <div class="col-md">
                    @*<AllorsInput RoleType="@M.Person.FirstName" />*@
                </div>
                <div class="col-md">
                    @*<AllorsInput RoleType="@M.Person.LastName" />*@
                </div>
            </div>


            <div class="row">
                <div class="col">
                    <button @onclick="HandleValidSubmit">Submit</button>
                </div>
            </div>
        </div>

    </EditForm>
}

@code {
    Context Context;

    [Parameter]
    public string id { get; set; }

    Person person;

    protected override async System.Threading.Tasks.Task OnInitializedAsync()
    {
        this.Context = new Context(this.Database, this.Workspace);

        var pull = new Pull
        {
            ObjectId = id
        };

        var result = await this.Context.Load(pull);

        this.person = result.GetObject<Person>("Person");
    }

    public async System.Threading.Tasks.Task HandleValidSubmit()
    {
        var response = await this.Context.Save();
        if (!response.HasErrors)
        {
            this.UriHelper.NavigateTo("/person/list");
        }
    }
}
